show <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./style.css" rel="stylesheet">
	<script src="./util.js" type="text/javascript"></script>
	<script src="/socket.io/socket.io.js"></script>
    <title>Filler game</title>
</head>
<body>
    <h1>Welcome to <span class="uppercase">Filler championship</span></h1>
    <section>
        <div class="flex flexGame">
            <div id="field">{field}</div>
            <div class="infoAndControls flex">
                <div class="score">
                    <div class="scoreWrapper">
                        <span id="playerXname">Player 1</span>
                        <div class="playerScore">
                            <div class="scoreBar X" id="playerX"></div>
                        </div>
                    </div>
                    <div class="scoreWrapper">
                        <span id="playerOname">Player 2</span>
                        <div class="playerScore">
                            <div class="scoreBar O" id="playerO"></div>
                        </div>
                    </div>
                </div>
                <!-- <div class="piece">
                    <span>current piece</span>
                    <div id="currentPiece"></div>
                </div> -->
                <div class="controlPanel">
                    <input class="button control" type="button" id="start" value="Start" />
                    <input class="button control" type="button" id="pause" value="Pause" />
                    <input class="button control" type="button" id="reset" value="Reset" />
                    <input class="button control" type="button" id="stepForward" value="Step forward" />
                    <input class="button control" type="button" id="stepBackward" value="Step backward" />
                </div>
            </div>
        </div>
		<br/>
		<div>
			<a class="button" href="http://localhost:3000">back</a>
		</div>
    </section>
    <footer>
        <span>Handcrafted by akraig</span>
    </footer>
    <script>
        let timerID;
		const socket = io();

        const updateField = (map) => {
            document.querySelector('#field').innerHTML = getField(map);
        };
        
        const updateScore = (score) => {
            let maxLength = score[0];
            let player1width = score[1] * 100 / maxLength;
            let player2width = score[2] * 100 / maxLength;
            document.querySelector('#playerO').style.width =  `${player1width}%`;
            document.querySelector('#playerX').style.width =  `${player2width}%`;
		};

		const updatePlayers = (players) => {
			if (players.length == 2) {
				document.querySelector('#playerOname').innerHTML = players[0];
				document.querySelector('#playerXname').innerHTML = players[1];
			}
		};
		
		const sendState = (state) => {
			socket.emit('state', state);
		};

		const getState = (socket) => {
			socket.emit('getState', null);
		};

        const start = () => {
			sendState('start');
            timerID = setInterval(() => {
                getState(socket);
            }, 33);
        };

        const pause = () => {
            clearInterval(timerID);
            sendState('pause');
        };

        /**
         * bug/feature/NOT TESTED:
         * After pressing 'RESET' UI should be able to show some further moves,
         * as long as history stores (with "STEP" buttons).
         * If pressed not too fast - possibly the whole game,
         * because VM is much faster than UI
         */

        const reset = () => {
            clearInterval(timerID);
            sendState('reset');
        };

        const stepForward = () => {
            clearInterval(timerID);
            sendState('stepForward');
        };

        const stepBackward = () => {
            clearInterval(timerID);
            sendState('stepBackward');
        };

		socket.on('update', data => {
			log(data);
			updateField(data.map);
			updatePlayers(data.players);
			updateScore(data.score);
		});

		socket.on('endgame', winner => {
			tempAlert({status: 200, message: winner});
		});

        sendState('load');
        document.querySelector('#start').onclick = start;
        document.querySelector('#pause').onclick = pause;
        document.querySelector('#reset').onclick = reset;
        document.querySelector('#stepForward').onclick = stepForward;
        document.querySelector('#stepBackward').onclick = stepBackward;
    </script>
</body>
</html>